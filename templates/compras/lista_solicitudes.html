{% extends 'base.html' %}
{% load staticfiles %}

{% block miga_pan %}
<li><a href="#"><i class="fa fa-dashboard"></i> Inicio</a></li>
<li><a href="{% url 'compras:index' %}">Compras</a></li>
<li class="active"><a href="{% url 'compras:solicitudes' %}">Solicitudes de compra</a></li>
{% endblock miga_pan %}

{% block titulo_pagina %}
Solicitudes de Compra
{% endblock titulo_pagina %}

{% block titulo %}Gesti√≥n de Solicitudes de Compras{% endblock titulo %}


{% block contenido %}
<div class="content-wrapper">
  <!-- Main content -->
  <section class="box">
    <div class="col-md-12">
      <!-- general form elements -->
      <div class="box box-primary">
        <!-- form start -->
        <div class="box-body">
          <!-- Panel colapsable -->
          {% if object_list %}
          <div class="container col-md-12">
            {% for solicitud in object_list %}
            <div class="panel-group" id="accordion">
              <div class="panel panel-default">

                <div class="panel-heading">
                  <h3 class="panel-title">
                    <a data-toggle="collapse" data-parent="#acordion" href="#collapse{{solicitud.id}}">
                      Solucitud #{{solicitud.id}}
                    </a>
                    {% if solicitud.estado_aprobacion == 'pendiente' %}
                    <i class="fa fa-circle text-yellow"></i> <!-- cambia color con el estado_aprobacion -->
                    {% elif solicitud.estado_aprobacion == 'rechazada' %}
                    <i class="fa fa-circle text-red"></i> <!-- cambia color con el estado -->
                    {% else %}
                    <i class="fa fa-circle text-green"></i> <!-- cambia color con el estado -->
                    {% endif %}
                  </h3>
                </div>

                <div id="collapse{{solicitud.id}}" class="panel-collapse collapse">
                  <div class="form-group row">
                    <div class="col-xs-6">
                      <label for="inputNombre">Nombre Solicitante</label>
                      <input type="text" class="form-control" id="inputNombre" disabled value="{{solicitud.solicitante.get_full_name}}">
                    </div>

                    <div class="col-xs-3">
                      <label for="inputId">Identificacion</label>
                      <input type="text" class="form-control" id="inputId" disabled placeholder={{solicitud.solicitante}}>
                    </div>
                  </div>

                  <div class="form-group row">
                    <div class="col-xs-6">
                      <label for="inputElemento">Articulos requeridos</label>
                      <ul>
                        {% for articulo in solicitud.articulos.all %}
                        <li> {{articulo.nombre}} </li>
                        {% endfor %}
                      </ul>
                    </div>
                  </div>

                  <div class="form-group row">
                    <div class=" col-xs-6">
                      <label for="exampleInputFile">Fecha esperada</label>
                      <!-- Date -->
                      <input disabled class="form-control pull-right datepicker" value="{{ solicitud.fecha_esperada}}"
                        autocomplete="off">
                    </div>
                  </div>

                  <div class="form-group row">
                    <div class=" col-xs-6">
                      <label for="inputJust">Justificacion</label>
                      <textarea id="inputJust" class="form-control pull-right" name="inputJust" rows="1" cols="50"
                        readonly>
                      {{solicitud.justificacion}}
                    </textarea>
                    </div>
                  </div>
                  <!-- collapse -->
                </div>
              </div>
            </div>
            {% endfor %}
          </div>
          {% else %}
          <h3>No hay solicitudes registradas</h3>
          {% endif %}
          <!-- /.box-body -->
        </div>
        <div class="box-footer text-center">
          <a href="{% url 'compras:solicitud_crear' %}" class="btn btn-success">Nueva Solicitud</a>
          <a href="{% url 'compras:solicitud_modificar' %}" class="btn btn-primary">Modificar Solicitud</a>
          <a href="{% url 'compras:solicitud_eliminar' %}" class="btn btn-danger">Eliminar Solicitud</a>
        </div>            
      </div>      
    </div>

    {% if usuario.rol == 'jefe_compras' or usuario.rol == 'gerente' %}

    <div class="col-md-12">
      <!-- general form elements -->
      <div class="box box-primary">
        <!-- form start -->

        <div class="box-body">
          <!-- Panel colapsable -->
          {% if solicitudes_autorizar %}
          <div class="container col-md-12">
            {% for solicitud in solicitudes_autorizar %}
            <div class="panel-group" id="accordion">
                <div class="panel panel-default">
  
                  <div class="panel-heading">
                    <h3 class="panel-title">
                      <a data-toggle="collapse" data-parent="#acordion" href="#collapse{{solicitud.id}}">
                        Solucitud #{{solicitud.id}}
                      </a>
                      <i class="fa fa-circle text-yellow"></i> <!-- cambia color con el estado -->
                    </h3>
                  </div>
  
                  <div id="collapse{{solicitud.id}}" class="panel-collapse collapse">
                    <div class="form-group row">
                      <div class="col-xs-6">
                        <label for="inputNombre">Nombre Solicitante</label>
                        <input type="text" class="form-control" id="inputNombre" disabled value="{{solicitud.solicitante.get_full_name}}">
                      </div>
  
                      <div class="col-xs-3">
                        <label for="inputId">Identificacion</label>
                        <input type="text" class="form-control" id="inputId" disabled placeholder={{solicitud.solicitante}}>
                      </div>
                    </div>
  
                    <div class="form-group row">
                      <div class="col-xs-6">
                        <label for="inputElemento">Articulos requeridos</label>
                        <ul>
                          {% for articulo in solicitud.articulos.all %}
                          <li> {{articulo.nombre}} </li>
                          {% endfor %}
                        </ul>
                      </div>
                    </div>
  
                    <div class="form-group row">
                      <div class=" col-xs-6">
                        <label for="exampleInputFile">Fecha esperada</label>
                        <!-- Date -->
                        <input disabled class="form-control pull-right datepicker" value="{{ solicitud.fecha_esperada}}"
                          autocomplete="off">
                      </div>
                    </div>
  
                    <div class="form-group row">
                      <div class=" col-xs-6">
                        <label for="inputJust">Justificacion</label>
                        <textarea id="inputJust" class="form-control pull-right" name="inputJust" rows="1" cols="50"
                          readonly>
                        {{solicitud.justificacion}}
                      </textarea>
                      </div>
                    </div>
                    <!-- collapse -->
                  </div>
                </div>
              </div>
            {% endfor %}
          </div>
          {% else %}
          <h3>No hay solicitudes por autorizar</h3>
          {% endif %}
          <!-- /.box-body -->
        </div>
        <!-- /.box -->
        <!-- /.box-body -->
      </div>
      <!-- /.box -->
    </div>
    {% endif %}

  </section>
  <!-- /.content -->
</div>
<!-- /.content-wrapper -->
{% endblock contenido %}